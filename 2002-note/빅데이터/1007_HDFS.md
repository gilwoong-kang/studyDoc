## 빅데이터

### 분산파일시스템

대용량의 데이터를 저장하고 있음. 네트워크로 연결된 사용자의 요청을 처리하며, 데이터를 적절하게 분배해줌. 분산시스템의 시작은 Google File System의 발표(SOSP 2003)가 시작이고 이것의 배포는 하둡으로 생각된다.

#### HDFS,GFS 시스템의 중요 목적

1. 대용량의 데이터 저장

   지속적으로 증가하며 다양한 포맷으로 증가하고 있다. 무한대의 가까운 저장을 목적으로.

2. 일반적 하드웨어를 사용하여 시스템 확장성 보장

3. 사용자 요청 및 데이터 증가하더라도 확장성 보장

4. 시퀀셜한 데이터 읽기 및 쓰기에 최적화

#### Hadoop File System(HDFS)

GFS의 구조를 차용한 오픈소스 기반의 분산파일 시스템. 블락으로 구분한 파일을 저장. 블락을 복제하여 데이터의 가용성을 높임. 만일 하나의 대용량 파일을 저장한다고 하면 이 파일을 블락 단위로 쪼개서 저장하게 된다. 

네임노드와 데이터 노드가 있음. 1개의 네임노드와 다수의 데이터노드. 네임노드는 메타데이터를 관리하는 것. 

##### Namenode

- 파일 : 일반적으로 인식하는 파일
- 블락 : 파일을 여러 조각으로 쪼갠 상태

> 예를들어 파일 사이즈가 700mb이고 블락 사이즈가 128mb라면 128mb블락 5개와 60mb블락 하나로 구성되게 된다. 

파일시스템의 네임스페이스를 구성한다. 파일을 블락으로 나눈 후 매핑된 기록을 저장함. 블락이 실제로 저장되어 있는 서버를 기록한다. 데이터 노듣즐의 정보를 관리한다.

네임노드 메타데이터는 항상 램에 저장해둠. 램에 모든 메타데이터가 저장될 정도로 충분 해야 한다. 메타데이터에 대해서는 페이징이 일어나서는 안됨. 메타데이터에게는 파일리스트, 각 파일에 포함된 블록 리스트, 각 블록이 저장된 데이터노드 리스트, 파일의 특성들이 포함된다. 

##### Datanode

- 분산 파일 저장 서버 

  각 데이터노드의 로컬 파일 저장소에 파일이 저장됨. 

블록 사이즈 설정이 중요하다. 블락의 사이즈가 커지면 블락의 갯수가 줄어들어 네임노드가 관리해야 하는 메타데이터 사이즈가 줄어든다. 또한 시퀀셜한 리드에 적합하도록 읽기의 높은 성능을 위해 큰 블록 사이즈가 필요하다. 

>  그렇다고 너무 크게 잡는다면 블락에 대한 병렬도가 낮아지기 때문에 효율적이지 못하다. 

- Heartbeet메시지

  데이터 노드는 네임노드에게 주기적으로 내가 살아있다고 메시지를 보낸다.

##### 데이터 복제

기본 정책은 3개의 복제본. 임의서버, 같은랙에 존재하는 다른 서버, 다른 랙 3개의 복제본을 둔다. 

##### 데이터노드의 실패 및 블락복제

Heartbeat메세지를 데이터노드가 주기적으로 네임노드에게 보낸다. 네임노드는 이 메세지를 파악하여 문제가 없음을 판별한다. (Soft-state) 문제가 생겼다고 판별하면 레플리카를 저장하기 위해 데이터노드를 선정. 즉 다른곳에 복제한다.

##### 네임노드의 실패

네임노드는 단일 실패점. 네임노드에 문제가 생기면 다른 기능까지 작동되지 않음. 네임노드는 전체 파일에 대한 메타 데이터르 저장하고 있다. 파일 디렉토리 관계, 파일 접근권한, 파일과 블록간 매핑, 복제정도를 기록하기에 중요하다. 빠른 접근을 위해 모든 업데이트 정보는 램에 저장. 램은 휘발성이기에 이를 극복하기 위한 방안. -> FSImage, Transaction log

##### FSImage & Transaction log

- FSImage

  모든 파일 및 블락의 메타데이터 정보를 파일시스템에 저장해 둔 파일. 모든 파일에 대한 정보를 저장하기에 랜덤 라이트 발생. 랜덤 라이트는 성능 좋지 않기에 모든 업데이트는 즉각적으로 FSImage에 반영되지 않음. 일단 업데이트 내용은 램에 저장되고 동시에 Transaction log파일에 저장됨.

- Transaction log

  현재 버전의 FSImage로부터의 변화를 이벤트 발생 순차적으로 기록해 둔 파일. 기록된 변화는 FSImage에 반영되어야 한다. -> 주기적으로, namenode가 다시 시작 될 때.

##### SecondaryNamenode

트랜잭션 로그에 있는 변환 사항을 FSImage로 주기적으로 반영해주는 프로세스. 
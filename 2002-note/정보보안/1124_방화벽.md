## 정보보호

### Firewall

방화벽이 내부망에 대한 패킷을 검사하고 올바르지 않으면 버림. 

0~1023까지는 주로 서버. (최근에는 더 늘어나긴 했음.) 이후 ~65535까지 클라이언트. 방화벽 테이블 볼줄 알아야. 위에서부터 우선순위다. 위에서부터 검열함.

안으로 들어오는 규칙에 대해 하나, 그것에 대한 응답을 위해 하나 더 해줘야 한다. (response때문에 규칙을 또 만들어야 함)

| **no** | **S_ip**          | **S_port** | **D_ip**          | **D_port** | **Prot.** | **action** |
| ------ | ----------------- | ---------- | ----------------- | ---------- | --------- | ---------- |
| 1      | *                 | *          | 210.123.36.100/32 | 80         | TCP       | accept     |
| 2      | 210.123.36.100/32 | 80         | *                 | *          | TCP       | accept     |
| 3      | 210.123.37.0/24   | 1024:65535 | *                 | *          | *         | accept     |
| 4      | *                 | *          | 210.123.37.0/24   | 1024:65535 | *         | accept     |
| 5      | *                 | *          | *                 | *          | *         | deny       |

• First-rule first-first

–(210.123.37.2, 2000, 164.210.293.17, 443, TCP) à accepted by the 3rd rule

이렇게 표현되고 이것이 몇번 규칙에 적용 되는가? 이런식으로 시험 가능. 풀이 해보자면 1번규칙은 목적지 규칙에 대해 탈락. 2번 규칙은 출발지 주소에 의해 탈락. 3번 규칙은 ip는 만족. 포트도 만족. 3번째 규칙에서 만족하여 방화벽 통과.

#### 문제 stateless

현재 이것은 옛버전. stateless firewall. 안밖 규칙을 따로 적용. 이 방식의 단점은 패킷을 다 따로 처리해야한다는것. 두번째는 공격상의 문제인데, •(His IP, His port, 210.123.37.10, 12345) 로 구성해서 보낸다고 해보자. 이것은 네번째 규칙에 의해 통과된다. 이러한 문제로 인해 statefull firewall. 이문제는 안에서 밖으로, 밖에서 안으로 방향성에 문제에 의해 만들어지는 문제이다.

#### 대책 statefull

| **no** | **S_ip**        | **S_port** | **D_ip**          | **D_port** | **Prot.** | **action** |
| ------ | --------------- | ---------- | ----------------- | ---------- | --------- | ---------- |
| 1      | *               | *          | 210.123.36.100/32 | 80         | TCP       | accept     |
| 2      | 210.123.37.0/24 | 1024:65535 | *                 | *          | *         | accept     |
| 3      | *               | *          | *                 | *          | *         | deny       |

방화벽이 패킷을 메모리에 기억하고 있다. 규칙에 의해 기억된 패킷을 기억하고 이것에 대한 응답을 내보낼때 기억한 메모리을 참조해 내보낸다. 

#### DMZ(demilitarized zone)

방화벽에 랜카드를 꽂아서 방화벽으로 흘러들어오는 정보를 dmz로 보내 독립성을 추구한다. 이렇게 하면 밖에서 dmz로 연결되는 규칙, dmz에서 내부 db로 접근하는 규칙. 

내부 스위치를 통해 접근이 아닌 방화벽을 통해서 접근하게 되므로 강력하다. (방화벽 규칙에 의해서만 접근 가능하므로.)

<img src="/Users/gilwoongkang/Library/Application Support/typora-user-images/image-20201124110909142.png" alt="image-20201124110909142" style="zoom:67%;" />

이런식으로 구현하는 곳이 많음. 

#### 방화벽 고장 문제

방화벽을 설치했더니 방화벽이 고장났을때 전체가 먹통되는 문제가 발생한다. 때문에 방화벽을 하나 더 두어서 가용성을 높혔다. 그런데 이때 문제가 발생한다. 방화벽이 두개이기 때문에 statefull을 위해 메모리에 패킷을 기억해놓은 것이 만일 다른쪽으로 갈 경우 메모리에 없기 때문에 거부한다. 이때문에 방화벽 윗,아랫단에 L4/L7 을 단다. 

<img src="/Users/gilwoongkang/Library/Application Support/typora-user-images/image-20201124111925323.png" alt="image-20201124111925323" style="zoom:50%;" />

패킷이 들어오면 »H(s_ip XOR d_ip) mod (# of firewall) 돌린다. 이렇게 돌리면 0,1 둘중에 하나가 나온다. 이렇게 구성해서 0이면 왼쪽, 1이면 오른쪽 이렇게 보낸다. XOR연산은 s_ip,d_ip값이 바뀌어도 값이 동일하므로 항상 같은 방화벽으로 들어갈 수 있게 됨. 

근데 이게 돈이 많이 든다 그래서 방화벽끼리 랜으로 연결하고 방화벽이 가진 정보를 동기화하도록 한다.

<img src="/Users/gilwoongkang/Library/Application Support/typora-user-images/image-20201124112236149.png" alt="image-20201124112236149" style="zoom:50%;" />

방화벽이 죽었는지 판별하는 것은 스위치가 지속해서 ping요청을 해당 경로로 보낸다. 때문에 장애에 대해 대처가 가능하다. 

### 고 가용성

고 가용성 문제는 때문에 방화벽 뿐만 아니라 라우터에도 적용 된다. 

**VRRP를 잘 이해할것.**

<img src="/Users/gilwoongkang/Library/Application Support/typora-user-images/image-20201124112754563.png" alt="image-20201124112754563" style="zoom:50%;" />

두 박스가 라우터. 두 대의 라우터는 각각 자신의 고유한 피지컬 ip를 가진다. 그리고 가상 ip 를 가지게 한다. 노트북들은 이 가상의 ip로 패킷을 토스. 만일 왼쪽이 주 라우터라면 가상 ip 주소를 왼쪽이 추가로 가지도록 한다. 그래서 일반적 통신을 왼쪽에게 시킨다. 그러면 오른쪽은 계속 듣고있는다. A가 나 살아있다는 브로드캐스트를 보내는데 이것을 잘 확인. 하다가 A의 브로드캐스트가 안오면 가상 ip를 자신이 가져옴. 이렇게 하면 서버들은 아이피를 바꾸지 않고도 계속 통신 할 수 있음. 

마스터와 슬레이브. 마스터가 처리하는 애고 슬레이브는 평소에 놀고있음. 마스터가 안되면 슬레이브가 처리. 해커가 자신이 마스터 행세를 하면 안되기 때문에 이런 통신은

 1.No authentication

2.Simple clear-text passwords

3.Strong authentication (using IP authentication with MD5 HMAC)

등 인증해서 처리.

근데 이게 하나를 놀게 하기가 너무 아까움. 그러면 가상 ip를 하나 더 두게 한다. 그래서 처리 하다가 하나 죽으면 그 죽은 아이피도 가져오게 함. 